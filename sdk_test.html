<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Omnize Agent SDK - Test</title>
    <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <script type="text/javascript" src="omz_agent_sdk.js"></script>
  </head>
  <body>
    <label>Select User:</label>
    <select id="token">
      <option value="eyJhbGciOiJSUzI1NiJ9.eyJpZCI6Nzk1MiwiZW1haWwiOiJmcmVkQG9tbml6ZS5tZSIsIm5hbWUiOiJGcmVkZXJpY28gQmVyZ2VyIiwicHJvZmlsZSI6IkFETUlOIiwic3Vic2NyaXB0aW9uIjoiQURNSU4iLCJwaG90byI6Imh0dHBzOi8vb216LXBob3RvLnMzLmFtYXpvbmF3cy5jb20vMTU0Mzk0MzE1MDg0NS5wbmciLCJkYXRlX2NyZWF0aW9uIjoiMjAxNi0wOS0xMyAxMzowMjo1MiBVVEMiLCJ0ZXh0X2xpbWl0IjoxLCJkZXBhcnRtZW50SWRzIjpbMzk2Miw1ODcxLDY0MjUsNjUxOV0sImFjY291bnQiOnsiaWQiOjMzNzMsIm5hbWUiOiJFbXByZXNhIE1hcm90YSIsImVtYWlsIjoiZnJlZEBvbW5pemUubWUiLCJwYXJ0bmVySWQiOm51bGx9LCJsaWNlbnNlQ29kZSI6IkRJR0lUQUwiLCJmZWF0dXJlcyI6W3sibmFtZSI6ImFnZW50X3ByaXZhdGVfaGlzdG9yeSIsInN0YXR1cyI6ImZhbHNlIn0seyJuYW1lIjoiYWdlbnRfY2hhbmdlX3Bob3RvIiwic3RhdHVzIjoidHJ1ZSJ9LHsibmFtZSI6ImZiX2FwcF9pZCIsInN0YXR1cyI6IjI5NzA5OTMyMzk5MTM5NiJ9LHsibmFtZSI6ImFkbWluX29ubGluZSIsInN0YXR1cyI6InRydWUifSx7Im5hbWUiOiJib3QiLCJzdGF0dXMiOiJ0cnVlIn0seyJuYW1lIjoicXVldWUiLCJzdGF0dXMiOiJ0cnVlIn0seyJuYW1lIjoibmV3X2N1c3RvbWVyIiwic3RhdHVzIjoidHJ1ZSJ9LHsibmFtZSI6Im9uX2Nsb3NlX2ludGVyYWN0aW9uIiwic3RhdHVzIjoiaW5ib3gvcXVldWUifSx7Im5hbWUiOiJoYXNfaW1hZ2VfbW9kYWwiLCJzdGF0dXMiOiJ0cnVlIn0seyJuYW1lIjoibXV0ZV9yaW5naW5nX2F1ZGlvIiwic3RhdHVzIjoidHJ1ZSJ9LHsibmFtZSI6InVyYSIsInN0YXR1cyI6InRydWUifSx7Im5hbWUiOiJoaWRlX3Bob25lX3JlcG9ydHNfdGFibGVfY29sdW1uIiwic3RhdHVzIjoiW1wicmVjZWl2ZWRcIiwgXCJtYWRlXCJdIn0seyJuYW1lIjoicGhvbmUiLCJzdGF0dXMiOiJ0cnVlIn0seyJuYW1lIjoiY29udGFjdCIsInN0YXR1cyI6InRydWUifSx7Im5hbWUiOiJzaG93X3VhaSIsInN0YXR1cyI6InRydWUifV0sInBlcm1pc3Npb25zIjpbeyJpZCI6InBhbmVsIiwic3RhdHVzIjoiIiwicGVybWlzc2lvbiI6eyJ2aWV3Ijp0cnVlfX0seyJpZCI6IndpZGdldCIsInN0YXR1cyI6IiIsInBlcm1pc3Npb24iOnsidmlldyI6dHJ1ZX19LHsiaWQiOiJjaGFubmVscyIsInN0YXR1cyI6IiIsInBlcm1pc3Npb24iOnsidmlldyI6dHJ1ZX19LHsiaWQiOiJlbWFpbCIsInN0YXR1cyI6IiIsInBlcm1pc3Npb24iOnsidmlldyI6ZmFsc2V9fSx7ImlkIjoibWVsaSIsInN0YXR1cyI6IiIsInBlcm1pc3Npb24iOnsidmlldyI6dHJ1ZX19LHsiaWQiOiJmYWNlYm9vayIsInN0YXR1cyI6IiIsInBlcm1pc3Npb24iOnsidmlldyI6dHJ1ZX19LHsiaWQiOiJ0ZWxlZ3JhbSIsInN0YXR1cyI6IiIsInBlcm1pc3Npb24iOnsidmlldyI6dHJ1ZX19LHsiaWQiOiJ1c2VycyIsInN0YXR1cyI6IiIsInBlcm1pc3Npb24iOnsidmlldyI6dHJ1ZX19LHsiaWQiOiJkZXBhcnRtZW50cyIsInN0YXR1cyI6IiIsInBlcm1pc3Npb24iOnsidmlldyI6dHJ1ZX19LHsiaWQiOiJ0YWdzIiwic3RhdHVzIjoiIiwicGVybWlzc2lvbiI6eyJ2aWV3Ijp0cnVlfX0seyJpZCI6InJlc3BvbnNlcyIsInN0YXR1cyI6InNvb24iLCJwZXJtaXNzaW9uIjp7InZpZXciOnRydWV9fSx7ImlkIjoib2ZmaWNlSG91ciIsInN0YXR1cyI6IiIsInBlcm1pc3Npb24iOnsidmlldyI6dHJ1ZX19LHsiaWQiOiJpbnRlZ3JhdGlvbnMiLCJzdGF0dXMiOiIiLCJwZXJtaXNzaW9uIjp7InZpZXciOnRydWV9fSx7ImlkIjoicmVwb3J0cyIsInN0YXR1cyI6IiIsInBlcm1pc3Npb24iOnsidmlldyI6ZmFsc2V9fSx7ImlkIjoiYWNjb3VudCIsInN0YXR1cyI6IiIsInBlcm1pc3Npb24iOnsidmlldyI6dHJ1ZX19LHsiaWQiOiJsaWNlbnNlcyIsInN0YXR1cyI6IiIsInBlcm1pc3Npb24iOnsidmlldyI6dHJ1ZX19LHsiaWQiOiJib3QiLCJzdGF0dXMiOiIiLCJwZXJtaXNzaW9uIjp7InZpZXciOnRydWV9fSx7ImlkIjoid2hpdGVMaXN0Iiwic3RhdHVzIjoiIiwicGVybWlzc2lvbiI6eyJ2aWV3Ijp0cnVlfX0seyJpZCI6InJlcG9ydFVzZXIiLCJzdGF0dXMiOiIiLCJwZXJtaXNzaW9uIjp7InZpZXciOnRydWV9fSx7ImlkIjoibmV3RGFzaGJvYXJkIiwic3RhdHVzIjoiIiwicGVybWlzc2lvbiI6eyJ2aWV3Ijp0cnVlfX0seyJpZCI6Im5ld1JlcG9ydCIsInN0YXR1cyI6IiIsInBlcm1pc3Npb24iOnsidmlldyI6dHJ1ZX19LHsiaWQiOiJwaG9uZVJlcG9ydCIsInN0YXR1cyI6IiIsInBlcm1pc3Npb24iOnsidmlldyI6ZmFsc2V9fSx7ImlkIjoiaGlzdG9yeVJlcG9ydCIsInN0YXR1cyI6IiIsInBlcm1pc3Npb24iOnsidmlldyI6dHJ1ZX19XSwidG90YWxWb2ljZSI6eyJzdGF0aW9uIjpudWxsLCJ0b2tlbiI6bnVsbH0sInN0YXR1cyI6IkFDVElWRSIsImRheXNfdG9fZXhwaXJlIjpudWxsLCJleHAiOjE1NzA2NDYzMTV9.ZyecppzjnQwfU6teUkRfXsgcI7SGjZ1o16885f41eTR4bQiRtm0670vFdrToa6fs9yipRGmfTmbcqP6nSpCp3TZPoqMkNEZDpSbjbr3EoxqJtDgLzQYHNTyd4Es6-_0xg_dTiy0Bat9Fvs8jtEheVe3nPeufoqJY4E9wuO4Mbr4Rnl-ie1UZaVwgYG7M85jmfe0q9bURMs5GMC5lg2A1QtvtlRNDgm1HnghiaWZeLyF1Ev2ma-EC-w9ZPeFZ411r6E6FA1BO9HYl5H0Mv8U4R3-GMaQmCu7nZSDJ4Y4SFLzvjkfG1MsC870NBb3wg9oOQEVbZkwkIlkaeOGYRaglkg">Fred</option>
      <option value="eyJhbGciOiJSUzI1NiJ9.eyJpZCI6MTEyNTAsImVtYWlsIjoiam9hb0BleGFtcGxlLmNvbSIsIm5hbWUiOiJKb8OjbyIsInByb2ZpbGUiOiJBR0VOVCIsInN1YnNjcmlwdGlvbiI6IkFHRU5UIiwicGhvdG8iOiJodHRwczovL29tei1waG90by5zMy5hbWF6b25hd3MuY29tLzE0OTM3NTk2ODg0MjIucG5nIiwiZGF0ZV9jcmVhdGlvbiI6IjIwMTctMDQtMDcgMTM6NTk6NTMgVVRDIiwidGV4dF9saW1pdCI6NSwiZGVwYXJ0bWVudElkcyI6WzM5NjIsNTg3MSw2NDI1XSwiYWNjb3VudCI6eyJpZCI6MzM3MywibmFtZSI6IkVtcHJlc2EgTWFyb3RhIiwiZW1haWwiOiJmcmVkQG9tbml6ZS5tZSIsInBhcnRuZXJJZCI6bnVsbH0sImxpY2Vuc2VDb2RlIjoiRElHSVRBTCIsImZlYXR1cmVzIjpbeyJuYW1lIjoiYWdlbnRfcHJpdmF0ZV9oaXN0b3J5Iiwic3RhdHVzIjoiZmFsc2UifSx7Im5hbWUiOiJhZ2VudF9jaGFuZ2VfcGhvdG8iLCJzdGF0dXMiOiJ0cnVlIn0seyJuYW1lIjoiZmJfYXBwX2lkIiwic3RhdHVzIjoiMjk3MDk5MzIzOTkxMzk2In0seyJuYW1lIjoiYWRtaW5fb25saW5lIiwic3RhdHVzIjoidHJ1ZSJ9LHsibmFtZSI6ImJvdCIsInN0YXR1cyI6InRydWUifSx7Im5hbWUiOiJxdWV1ZSIsInN0YXR1cyI6InRydWUifSx7Im5hbWUiOiJuZXdfY3VzdG9tZXIiLCJzdGF0dXMiOiJ0cnVlIn0seyJuYW1lIjoib25fY2xvc2VfaW50ZXJhY3Rpb24iLCJzdGF0dXMiOiJpbmJveC9xdWV1ZSJ9LHsibmFtZSI6Imhhc19pbWFnZV9tb2RhbCIsInN0YXR1cyI6InRydWUifSx7Im5hbWUiOiJtdXRlX3JpbmdpbmdfYXVkaW8iLCJzdGF0dXMiOiJ0cnVlIn0seyJuYW1lIjoidXJhIiwic3RhdHVzIjoidHJ1ZSJ9LHsibmFtZSI6ImhpZGVfcGhvbmVfcmVwb3J0c190YWJsZV9jb2x1bW4iLCJzdGF0dXMiOiJbXCJyZWNlaXZlZFwiLCBcIm1hZGVcIl0ifSx7Im5hbWUiOiJwaG9uZSIsInN0YXR1cyI6InRydWUifSx7Im5hbWUiOiJjb250YWN0Iiwic3RhdHVzIjoidHJ1ZSJ9LHsibmFtZSI6InNob3dfdWFpIiwic3RhdHVzIjoidHJ1ZSJ9XSwicGVybWlzc2lvbnMiOlt7ImlkIjoicGFuZWwiLCJzdGF0dXMiOiIiLCJwZXJtaXNzaW9uIjp7InZpZXciOmZhbHNlfX0seyJpZCI6IndpZGdldCIsInN0YXR1cyI6IiIsInBlcm1pc3Npb24iOnsidmlldyI6ZmFsc2V9fSx7ImlkIjoiY2hhbm5lbHMiLCJzdGF0dXMiOiIiLCJwZXJtaXNzaW9uIjp7InZpZXciOmZhbHNlfX0seyJpZCI6ImVtYWlsIiwic3RhdHVzIjoiIiwicGVybWlzc2lvbiI6eyJ2aWV3IjpmYWxzZX19LHsiaWQiOiJtZWxpIiwic3RhdHVzIjoiIiwicGVybWlzc2lvbiI6eyJ2aWV3IjpmYWxzZX19LHsiaWQiOiJmYWNlYm9vayIsInN0YXR1cyI6IiIsInBlcm1pc3Npb24iOnsidmlldyI6ZmFsc2V9fSx7ImlkIjoidGVsZWdyYW0iLCJzdGF0dXMiOiIiLCJwZXJtaXNzaW9uIjp7InZpZXciOmZhbHNlfX0seyJpZCI6InVzZXJzIiwic3RhdHVzIjoiIiwicGVybWlzc2lvbiI6eyJ2aWV3IjpmYWxzZX19LHsiaWQiOiJkZXBhcnRtZW50cyIsInN0YXR1cyI6IiIsInBlcm1pc3Npb24iOnsidmlldyI6ZmFsc2V9fSx7ImlkIjoidGFncyIsInN0YXR1cyI6IiIsInBlcm1pc3Npb24iOnsidmlldyI6ZmFsc2V9fSx7ImlkIjoicmVzcG9uc2VzIiwic3RhdHVzIjoic29vbiIsInBlcm1pc3Npb24iOnsidmlldyI6ZmFsc2V9fSx7ImlkIjoib2ZmaWNlSG91ciIsInN0YXR1cyI6IiIsInBlcm1pc3Npb24iOnsidmlldyI6ZmFsc2V9fSx7ImlkIjoiaW50ZWdyYXRpb25zIiwic3RhdHVzIjoiIiwicGVybWlzc2lvbiI6eyJ2aWV3IjpmYWxzZX19LHsiaWQiOiJyZXBvcnRzIiwic3RhdHVzIjoiIiwicGVybWlzc2lvbiI6eyJ2aWV3IjpmYWxzZX19LHsiaWQiOiJhY2NvdW50Iiwic3RhdHVzIjoiIiwicGVybWlzc2lvbiI6eyJ2aWV3IjpmYWxzZX19LHsiaWQiOiJsaWNlbnNlcyIsInN0YXR1cyI6IiIsInBlcm1pc3Npb24iOnsidmlldyI6ZmFsc2V9fSx7ImlkIjoiYm90Iiwic3RhdHVzIjoiIiwicGVybWlzc2lvbiI6eyJ2aWV3IjpmYWxzZX19LHsiaWQiOiJ3aGl0ZUxpc3QiLCJzdGF0dXMiOiIiLCJwZXJtaXNzaW9uIjp7InZpZXciOmZhbHNlfX0seyJpZCI6InJlcG9ydFVzZXIiLCJzdGF0dXMiOiIiLCJwZXJtaXNzaW9uIjp7InZpZXciOmZhbHNlfX0seyJpZCI6Im5ld0Rhc2hib2FyZCIsInN0YXR1cyI6IiIsInBlcm1pc3Npb24iOnsidmlldyI6ZmFsc2V9fSx7ImlkIjoibmV3UmVwb3J0Iiwic3RhdHVzIjoiIiwicGVybWlzc2lvbiI6eyJ2aWV3IjpmYWxzZX19LHsiaWQiOiJwaG9uZVJlcG9ydCIsInN0YXR1cyI6IiIsInBlcm1pc3Npb24iOnsidmlldyI6ZmFsc2V9fSx7ImlkIjoiaGlzdG9yeVJlcG9ydCIsInN0YXR1cyI6IiIsInBlcm1pc3Npb24iOnsidmlldyI6dHJ1ZX19XSwidG90YWxWb2ljZSI6eyJzdGF0aW9uIjoxNDMzNDUzNCwidG9rZW4iOm51bGx9LCJzdGF0dXMiOiJBQ1RJVkUiLCJkYXlzX3RvX2V4cGlyZSI6bnVsbCwiZXhwIjoxNTcwNzEyMDk4fQ.qblOh82dUmrS0U3s11J7d_veMurSRoZ5SUvx1sKgqMzHzMtgB6AVJHJrp3jqz0K8w7ZtOljoakmJWWyRZZpu60pKkJmnXo275tXk05uG0MpXDdRCVZ2MM0VcadJ3wYXxY71zven3PCpd-M6987YfBNrBsJzc1JjzP1NJAMuzOME8UFXN8Nv-MzW3-vY-9LoN0qz4RL4hIWZxfVzsMbuIQZ02Dajae0EP0zvDIiBWfpOK6sviCqxIds5oRY2vj0u5WeAzHIFj5Q4UtL9YlxgsbBuS_jvjH6zbfyETKrCihLqxkqZzRMqqoiIOT-xYrT94d7u3qCyNgNg9M679mLHlcw">João</option>
    </select>
    <button id="connect">Connect</button>

    <br/>
    <br/>

    <div id="connectedBlock" style="display: none">
      <button id="register">Register</button>
      <button id="unregister">Unregister</button>

      <br/>
      <br/>

      <div>
        <label>Saída:</label><br/>
        <textarea id="console" rows="10" cols="50"></textarea>
      </div>

      <div id="interactions">
        <label>Interaction: <span id="interactionHash"></span><span id="currentState"></span></label><br/>
        <button id="accept">Accept</button>
        <button id="finish">Finish</button>
        <button id="close">Close</button><br/>
        <textarea id="interactionArea" rows="20" cols="50"></textarea><br/>
        <input type="text" id="messageInput"/>
        <button id="send">Send</button>
        <button id="typing">Typing</button>
        <button id="cleared">Cleared</button>
      </div>
      <div id="transference">
        <button id="getTransferList">Load list</button>
        <table>
          <thead>
            <th>Type</th>
            <th>Id</th>
            <th>Name</th>
            <th>Status/Agents</th>
            <th></th>
          </thead>
          <tbody id="transferenceList"></tbody>
        </table>
      </div>
    </div>

    <script>
      var consoleArea = document.getElementById('console');
      var sdk;
      var currentInteractionHash;

      function print(text) {
        consoleArea.innerHTML += text + '\n';
      };

      function clearInteraction() {
        currentInteractionHash = null;
        document.getElementById('interactionHash').innerText = '';
        document.getElementById('currentState').innerText = '';
        document.getElementById('interactionArea').innerHTML = '';
        document.getElementById('transferenceList').innerHTML = '';
      };

      function transferToDepartment(id) {
        sdk.transferToDepartment(id, currentInteractionHash);
      }

      function transferToAgent(id, departmentId) {
        sdk.transferToAgent(id, departmentId, currentInteractionHash);
      }

      document.getElementById('connect').addEventListener('click', function (e) {
        document.getElementById('connectedBlock').style.display = "block";

        sdk = new OmnizeVish(document.getElementById('token').value);
        sdk.on('registered', () => print("Registered"))
        sdk.on('unregistered', () => print("Unregistered"))

        sdk.on('newInteraction', ({ interactionHash, id, customerInfo, department, interactionType, externalHistory, currentState, createdAt }) => {
          currentInteractionHash = interactionHash;
          document.getElementById('interactionHash').innerText = `${interactionHash}`;
          document.getElementById('currentState').innerText = ` (${currentState})`;

          document.getElementById('interactionArea').innerHTML += `Customer: ${customerInfo.fields[3].value}\n`;
          document.getElementById('interactionArea').innerHTML += `Media: ${interactionType}\n`;
        })

        sdk.on('acceptedInteraction', (interactionHash) => {
          document.getElementById('interactionArea').innerHTML += `Accepted\n\n`;
        })

        sdk.on('updateInteraction', (interaction) => {
          document.getElementById('currentState').innerText = ` (${interaction.currentState})`;
        })

        sdk.on('canceled', (interactionHash) => {
          clearInteraction();
        })

        sdk.on('newMessage', ({ createdAt, content, interactionHash, contentType, messageId, url }) => {
          document.getElementById('interactionArea').innerHTML += `Customer Msg (${createdAt} - ${contentType}): ${content}\n`;
        })

        sdk.on('receivedMessage', ({ messageId, interactionHash, tempId }) => {
          document.getElementById('interactionArea').innerHTML += `Message received (Id: ${messageId}, TempId: ${tempId})\n`;
        })

        sdk.on('deliveredMessage', ({ messageId, interactionHash }) => {
          document.getElementById('interactionArea').innerHTML += `Message delivered (Id: ${messageId})\n`;
        })

        sdk.on('finishedInteraction', (interactionHash, reason) => {
          document.getElementById('interactionArea').innerHTML += `Client finished\n`;
        })

        sdk.on('typing', (interactionHash) => {
          document.getElementById('interactionArea').innerHTML += `Client typing\n`;
        })

        sdk.on('cleared', (interactionHash) => {
          document.getElementById('interactionArea').innerHTML += `Client cleared\n`;
        })

        sdk.on('transferred', (interactionHash) => {
          clearInteraction();
          print("Transferred");
        })

        sdk.on('transferFailed', (interactionHash, reason = '') => {
          print(`Transfer failed: ${reason}`);
        })

        sdk.connect();
      });

      document.getElementById('register').addEventListener('click', function (e) {
        sdk.register();
      });

      document.getElementById('unregister').addEventListener('click', function (e) {
        sdk.unregister();
      });

      document.getElementById('unregister').addEventListener('click', function (e) {
        sdk.unregister();
      });

      document.getElementById('accept').addEventListener('click', function (e) {
        sdk.acceptInteraction(currentInteractionHash);
      });

      document.getElementById('send').addEventListener('click', function (e) {
        var content = document.getElementById('messageInput').value;
        var tempId = sdk.newMessage(content, currentInteractionHash, 'text');
        document.getElementById('interactionArea').innerHTML += `Agent Msg (tempId: ${tempId}): ${content}\n`;
        content = '';
      });

      document.getElementById('finish').addEventListener('click', function (e) {
        document.getElementById('interactionArea').innerHTML += `Agent finish\n`;
        sdk.finishInteraction(currentInteractionHash)
      });

      document.getElementById('close').addEventListener('click', function (e) {
        clearInteraction();
      });

      document.getElementById('typing').addEventListener('click', function (e) {
        sdk.typing(currentInteractionHash);
      });

      document.getElementById('cleared').addEventListener('click', function (e) {
        sdk.cleared(currentInteractionHash);
      });

      document.getElementById('getTransferList').addEventListener('click', function (e) {
        sdk.getTransferList((response) => {
          if (response.status == 200 && response.result) {
            if (response.result.departments) {
              response.result.departments.forEach(department => {
                document.getElementById('transferenceList').innerHTML += `
                  <td>Department</td>
                  <td>${department.id}</td>
                  <td>${department.name}</td>
                  <td>${department.agents.length}</td>
                  <td><button onclick="transferToDepartment(${department.id})">Transfer</button></td>
                `;
              });
            }
            if (response.result.agents) {
              response.result.agents.forEach(agent => {
                document.getElementById('transferenceList').innerHTML += `
                  <td>Agent</td>
                  <td>${agent.id}</td>
                  <td>${agent.name}</td>
                  <td>${agent.newStatus}</td>
                  <td><button onclick="transferToAgent(${agent.id}, ${agent.department.id})">Transfer</button></td>
                `;
              });
            }
          }
        });
      });
    </script>
  </body>
</html>
